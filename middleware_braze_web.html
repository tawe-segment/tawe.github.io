<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" type="text/css" href="css/index.css">
    <title>Destination Middleware Page</title>
    <script>
        !function () {
            var analytics = window.analytics = window.analytics || []; if (!analytics.initialize) if (analytics.invoked) window.console && console.error && console.error("Segment snippet included twice."); else {
                analytics.invoked = !0; analytics.methods = ["trackSubmit", "trackClick", "trackLink", "trackForm", "pageview", "identify", "reset", "group", "track", "ready", "alias", "debug", "page", "once", "off", "on", "addSourceMiddleware", "addIntegrationMiddleware", "setAnonymousId", "addDestinationMiddleware"]; analytics.factory = function (e) { return function () { var t = Array.prototype.slice.call(arguments); t.unshift(e); analytics.push(t); return analytics } }; for (var e = 0; e < analytics.methods.length; e++) { var key = analytics.methods[e]; analytics[key] = analytics.factory(key) } analytics.load = function (key, e) { var t = document.createElement("script"); t.type = "text/javascript"; t.async = !0; t.src = "https://cdn.segment.com/analytics.js/v1/" + key + "/analytics.min.js"; var n = document.getElementsByTagName("script")[0]; n.parentNode.insertBefore(t, n); analytics._loadOptions = e }; analytics._writeKey = "kxu54FZnPqGFfWYgOhHB4yMfph1ZWSWK";; analytics.SNIPPET_VERSION = "4.15.3";
                analytics.load("kxu54FZnPqGFfWYgOhHB4yMfph1ZWSWK", { integrations: { All: false, 'Facebook Pixel': true, 'Braze Web Mode (Actions)': true } });
            }
        }();
    </script>
    <script>
        function destMW() {
            //MW function signature
            var destMW1 = async function ({ payload, next, integration }) {
                console.log(payload)

                //truthy if the event triggered is "Some Specific Event" 
                if (payload.obj.event === "Order Completed") {
                    next(payload); //if so, deliver the payload, anything else apart from above is dropped
                }
            }
            //add / activate the middleware for the destination
            analytics.addDestinationMiddleware('Braze Web Mode (Actions)', [destMW1]);

            //should not be sent to FB Pixel
            analytics.track('Product Viewed', {
                product_id: "123456",
                category: "xyz",
                name: "Test Title",
                content_name: "Test title",
                brand: "TobiTest",
                price: 35.00,
                quantity: "1",
                currency: "USD",
                value: 35.00,
            });

            //should be sent to FB Pixel
            analytics.track('Order Completed', {
                checkout_id: 'fksdjfsdjfisjf9sdfjsd9f',
                order_id: '50314b8e9bcf000000000000',
                affiliation: 'Google Store',
                total: 27.50,
                subtotal: 22.50,
                revenue: 25.00,
                shipping: 3,
                tax: 2,
                discount: 2.5,
                coupon: 'hasbros',
                currency: 'USD',
                products: [
                    {
                        product_id: '507f1f77bcf86cd799439011',
                        sku: '45790-32',
                        name: 'Monopoly: 3rd Edition',
                        price: 19,
                        quantity: 1,
                        category: 'Games',
                        url: 'https://www.example.com/product/path',
                        image_url: 'https:///www.example.com/product/path.jpg'
                    },
                    {
                        product_id: '505bd76785ebb509fc183733',
                        sku: '46493-32',
                        name: 'Uno Card Game',
                        price: 3,
                        quantity: 2,
                        category: 'Games'
                    }
                ]
            });

        }
    </script>
</head>

<body>
    <p>Just Another Page: Conditional event middleware
        <input type="button" class="idBtn" onclick="destMW()" value="MW Event">
    </p>
</body>

</html>