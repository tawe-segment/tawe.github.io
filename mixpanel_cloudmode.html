<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" type="text/css" href="css/index.css">
    <title>Mixpanel Testing Page</title>
    <script>
        !function () {
            var analytics = window.analytics = window.analytics || []; if (!analytics.initialize) if (analytics.invoked) window.console && console.error && console.error("Segment snippet included twice."); else {
                analytics.invoked = !0; analytics.methods = ["trackSubmit", "trackClick", "trackLink", "trackForm", "pageview", "identify", "reset", "group", "track", "ready", "alias", "debug", "page", "once", "off", "on", "addSourceMiddleware", "addIntegrationMiddleware", "setAnonymousId", "addDestinationMiddleware"]; analytics.factory = function (e) { return function () { var t = Array.prototype.slice.call(arguments); t.unshift(e); analytics.push(t); return analytics } }; for (var e = 0; e < analytics.methods.length; e++) { var key = analytics.methods[e]; analytics[key] = analytics.factory(key) } analytics.load = function (key, e) { var t = document.createElement("script"); t.type = "text/javascript"; t.async = !0; t.src = "https://cdn.segment.com/analytics.js/v1/" + key + "/analytics.min.js"; var n = document.getElementsByTagName("script")[0]; n.parentNode.insertBefore(t, n); analytics._loadOptions = e }; analytics._writeKey = "kxu54FZnPqGFfWYgOhHB4yMfph1ZWSWK";; analytics.SNIPPET_VERSION = "4.15.3";
                analytics.load("kxu54FZnPqGFfWYgOhHB4yMfph1ZWSWK");
            }
        }();
    </script>
    <script>
        var smw1 = function ({ payload, next, integrations }) {
            console.log(payload)

            const getUA = () => {
                let device = "Unknown";
                const ua = {
                    "Generic Linux": /Linux/i,
                    "Android": /Android/i,
                    "BlackBerry": /BlackBerry/i,
                    "Bluebird": /EF500/i,
                    "Chrome OS": /CrOS/i,
                    "Datalogic": /DL-AXIS/i,
                    "Honeywell": /CT50/i,
                    "iPad": /iPad/i,
                    "iPhone": /iPhone/i,
                    "iPod": /iPod/i,
                    "macOS": /Macintosh/i,
                    "Windows": /IEMobile|Windows/i,
                    "Zebra": /TC70|TC55/i,
                }
                Object.keys(ua).map(v => navigator.userAgent.match(ua[v]) && (device = v));
                return device;
            }
            var device_type = getUA();

            console.log(device_type)

            //adds Device as traits for identify or property for events
            // payload.obj.properties.Device = device_type; 
            payload.obj.type = "identify" ? payload.obj.traits.Device = device_type : payload.obj.properties.Device = device_type

            next(payload); //delivers the payload to Segment servers 

        };
        analytics.addSourceMiddleware(smw1); //activate/add the source middleware to ajs

        analytics.identify("001mixcm-1")
        analytics.page("Mixpanel Page - CM") //CM = cloud mode
        analytics.track("Mixpanel Event - CM"); //CM = cloud mode
    </script>
</head>

<body>
    <p>Just Another Page: Mixpanel Device Mode </p>
</body>

</html>