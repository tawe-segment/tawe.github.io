<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" type="text/css" href="css/index.css">
    <title>Middleware Page</title>
    <!-- <script src="src/index.js"></script> -->
    <!-- Google Tag Manager -->
    <script>(function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start':
                    new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                    'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-5X58TDG');</script>
    <!-- End Google Tag Manager -->
    <script>
        !function () {
            var analytics = window.analytics = window.analytics || []; if (!analytics.initialize) if (analytics.invoked) window.console && console.error && console.error("Segment snippet included twice."); else {
                analytics.invoked = !0; analytics.methods = ["trackSubmit", "trackClick", "trackLink", "trackForm", "pageview", "identify", "reset", "group", "track", "ready", "alias", "debug", "page", "once", "off", "on", "addSourceMiddleware", "addIntegrationMiddleware", "setAnonymousId", "addDestinationMiddleware"]; analytics.factory = function (e) { return function () { var t = Array.prototype.slice.call(arguments); t.unshift(e); analytics.push(t); return analytics } }; for (var e = 0; e < analytics.methods.length; e++) { var key = analytics.methods[e]; analytics[key] = analytics.factory(key) } analytics.load = function (key, e) { var t = document.createElement("script"); t.type = "text/javascript"; t.async = !0; t.src = "https://cdn.segment.com/analytics.js/v1/" + key + "/analytics.min.js"; var n = document.getElementsByTagName("script")[0]; n.parentNode.insertBefore(t, n); analytics._loadOptions = e }; analytics._writeKey = "wOSUOOubBvU6lqF47Y52plMlMiAbvUXQ";; analytics.SNIPPET_VERSION = "4.15.3";
                analytics.load("kxu54FZnPqGFfWYgOhHB4yMfph1ZWSWK", { integrations: { 'Google Tag Manager': false } });
            }
        }();
    </script>
    <script>
        var smw1 = function ({ payload, next, integrations }) {
            // console.log(payload.obj.event)
            // console.log(payload.obj)
            // console.log(payload)

            if (payload.obj.event) { //truthy when analytics.track() is called - falsey for any other methods.
                var userId = analytics.user().id(); //the Segment userid
                var anonymousId = analytics.user().anonymousId(); //the Segment anonymousId
                var props = payload.obj.properties; //store the Segment event properties inside props variable
                if (userId) props.userId = userId; //store the Segment user id inside props variable
                if (anonymousId) props.segmentAnonymousId = anonymousId; //store the Segment anonymousId inside props variable
                props.event = payload.obj.event; //add the event name into props variable
                // console.log(props)
                dataLayer.push(props) //push props into the dataLayer
            }
            next(payload); //deliver the payload to Segment servers 
        };
        analytics.addSourceMiddleware(smw1); //activate/add the source middleware to ajs
    </script>
    <!-- <script>
        var smw4 = function ({ payload, next, integrations }) {
            if(payload.obj.event === "Test Event"){
                payload.obj.event += " SM";
                next(payload);
            } 
            else if(payload.obj.event !== "Test Event"){
                next(payload);
            }
            
        };
        analytics.addSourceMiddleware(smw4);
    </script> -->
</head>

<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5X58TDG" height="0" width="0"
            style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <p>Just Another Page: Testing middlewares</p>
    <!-- <button class="btn btn-primary" onclick="addMiddlewares()">
    Add middlewares
  </button> -->
</body>

</html>